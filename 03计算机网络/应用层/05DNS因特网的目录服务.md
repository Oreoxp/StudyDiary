### 2.5　DNS：因特网的目录服务

​		人类能以很多方式来标识。例如，我们能够通过出生证书上的名字来标识；能够通过社会保险号码来标识；也能够通过驾驶执照上的号码来标识。尽管这些标识办法都可以用来识别一个人，但是在特定环境下，某种识别方法可能比另一种方法更为适合。例如，IRS（美国的一个声名狼藉的税务征收机构）的计算机更喜欢使用定长的社会保险号码而不是出生证书上的姓名。另一方面，普通人乐于使用更好记的出生证书上的姓名而不是社会保险号码。（毫无疑问，你能想象人们之间以这种方式说话吗？如“你好，我叫132-67-9875。请找一下我的丈夫178-87-1146”。）

​		因特网上的主机和人类一样，可以使用多种方式进行标识。主机的一种标识方法是用它的主机名（hostname），如cnn.com、www.yahoo.com、gaia.cs.umass.edu以及cis.poly.edu等，这些名字便于记忆也乐于被人们接受。然而，主机名几乎没有提供（即使有也很少）关于主机在因特网中位置的信息。（一个名为www.eurecom.fr的主机以国家码.fr结束，告诉我们该主机很可能在法国，仅此而已。）况且，因为主机名可能由不定长的字母数字组成，路由器难以处理。由于这些原因，主机也可以使用所谓IP地址（IP address）进行标识。
我们将在第4章更为详细地讨论IP地址，但现在简略地介绍一下还是有必要的。一个IP地址由4个字节组成，并有着严格的层次结构。例如121.7.106.83这样一个IP地址，其中的每个字节都被句点分隔开来，表示了0～255的十进制数字。我们说IP地址具有层次结构，是因为当我们从左至右扫描它时，我们会得到越来越具体的关于主机位于因特网何处的信息（即在众多网络的哪个网络里）。类似地，当我们从下向上查看邮政地址时，我们能够获得该地址位于何处的越来越具体的信息。

### 2.5.1　DNS提供的服务

​		我们刚刚看到了识别主机有两种方式，通过主机名或者IP地址。人们喜欢便于记忆的主机名标识方式，而路由器则喜欢定长的、有着层次结构的IP地址。为了折衷这些不同的偏好，我们需要一种能进行主机名到IP地址转换的目录服务。这就是域名系统（Domain Name System，DNS）的主要任务。DNS是：①一个由分层的DNS服务器（DNS server）实现的分布式数据库；②一个使得主机能够查询分布式数据库的应用层协议。DNS服务器通常是运行BIND（Berkeley Internet Name Domain）软件［BIND 2012］的UNIX机器。DNS协议运行在UDP之上，使用53号端口。
![image](https://yqfile.alicdn.com/359d02ce8931251d0f3a6f17d233a76650838a53.png)

​		DNS通常是由其他应用层协议所使用的，包括HTTP、SMTP和FTP，将用户提供的主机名解析为IP地址。举一个例子，考虑当某个用户主机上的一个浏览器（即一个HTTP客户）请求URL www.someschool.edu/index.html页面时会发生什么现象。为了使用户的主机能够将一个HTTP请求报文发送到Web服务器www.someschool.edu，该用户主机必须获得www.someschool.edu的IP地址。其做法如下。

- 同一台用户主机上运行着DNS应用的客户端。
- 浏览器从上述URL中抽取出主机名www.someschool.edu，并将这台主机名传给DNS应用的客户端。
- DNS客户向DNS服务器发送一个包含主机名的请求。
- DNS客户最终会收到一份回答报文，其中含有对应于该主机名的IP地址。
- 一旦浏览器接收到来自DNS的该IP地址，它能够向位于该IP地址80端口的HTTP服务器进程发起一个TCP连接。

从这个例子中，我们可以看到DNS给使用它的因特网应用带来了额外的时延，有时还相当可观。幸运的是，如我们下面讨论的那样，想获得的IP地址通常就缓存在一个“附近的”DNS服务器中，这有助于减少DNS的网络流量和DNS的平均时延。
除了进行主机名到IP地址的转换外，DNS还提供了一些重要的服务：

- 主机别名（host aliasing）。有着复杂主机名的主机能拥有一个或者多个别名。例如，一台名为relay1.west-coast.enterprise.com的主机，可能还有两个别名为enterprise.com和www.enterprise.com。在这种情况下，relay1.west-coast.enterprise.com也称为规范主机名（canonical hostname）。主机别名（当存在时）比主机规范名更加容易记忆。应用程序可以调用DNS来获得主机别名对应的规范主机名以及主机的IP地址。
- 邮件服务器别名（mail server aliasing）。显而易见，人们也非常希望电子邮件地址好记忆。例如，如果Bob在Hotmail上有一个账户，Bob的邮件地址就像bob@hotmail.com这样简单。然而，Hotmail邮件服务器的主机名可能更为复杂，不像hotmail.com那样简单好记（例如，规范主机名可能像relay1.west-coast.hotmail.com那样）。电子邮件应用程序可以调用DNS，对提供的邮件服务器别名进行解析，以获得该主机的规范主机名及其IP地址。事实上，MX记录（参见后面）允许一个公司的邮件服务器和Web服务器使用相同（别名化的）的主机名；例如，一个公司的Web服务器和邮件服务器都能叫做enterprise.com。
- 负载分配（load distribution）。DNS也用于在冗余的服务器（如冗余的Web服务器等）之间进行负载分配。繁忙的站点（如cnn.com）被冗余分布在多台服务器上，每台服务器均运行在不同的端系统上，每个都有着不同的IP地址。由于这些冗余的Web服务器，一个IP地址集合因此与同一个规范主机名相联系。DNS数据库中存储着这些IP地址集合。当客户对映射到某地址集合的名字发出一个DNS请求时，该服务器用IP地址的整个集合进行响应，但在每个回答中循环这些地址次序。因为客户通常总是向IP地址排在最前面的服务器发送HTTP请求报文，所以DNS就在所有这些冗余的Web服务器之间循环分配了负载。DNS的循环同样可以用于邮件服务器，因此，多个邮件服务器可以具有相同的别名。一些内容分发公司如Akamai也以更加复杂的方式使用DNS［Dilley 2002］，以提供Web内容分发（参见第7章）。

DNS由RFC 1034和RFC 1035定义，并且在几个附加的RFC中进行了更新。DNS是一个复杂的系统，我们在这里只是就其运行的主要方面进行学习。感兴趣的读者可以参考这些RFC文档和Albitz和Liu写的书［Albitz 1993］；亦可参阅文章［Mockapetris 1998］和［Mockapetris 2005］，其中［Mockapetris 1998］是回顾性的文章，它提供了DNS组成和工作原理的精细的描述。