## 表示程序性能

​		我们引入度量标准每**元素的周期数（Cycles Per Element，CPE)**，作为一种表示程序性能并指导我们改进代码的方法。CPE 这种度量标准帮助我们在更细节的级别上理解迭代程序的循环性能。这样的度量标准对执行重复计算的程序来说是很适当的，例如处理图像中的像素，或是计算矩阵乘积中的元素。

​		处理器活动的顺序是由时钟控制的，时钟提供了某个频率的规律信号，通常用**千兆赫 .兹(GHz)**,即十亿周期每秒来表示。例如，当表明一个系统有 “ 4GHz ” 处理器，这表示处理器时钟运行频率为每秒 4 X 109 个周期。每个时钟周期的时间是时钟频率的倒数。通常是以纳秒（nanosecond，1纳秒等于10_9秒）或皮秒（picosecond, 1皮秒等于10 —12秒）为单位的。例如，一个4GHz的时钟其周期为 0.25 纳秒，或者 250 皮秒。从程序员的角度来 看，用时钟周期来表示度量标准要比用纳秒或皮秒来表示有帮助得多。用时钟周期来表示，度量值表示的是执行了多少条指令，而不是时钟运行得有多快。

​		许多过程含有在一组元素上迭代的循环。例如，图5-1中的函数 psum1 和 psum2 计算的都是一个长度为 n 的向量的**前置和（prefix sum)**。对于向量![02公式1](.\markdowniamge\02公式1.png)，前置和![02公式2](.\markdowniamge\02公式2.png)定义为

![02前置和函数](.\markdowniamge\02前置和函数.png)

​		函数psum1每次迭代计算结果向量的一个元素。第二个函数使用**循环展开（loop unrolling)** 的技术，每次迭代计算两个元素 。本章后面我们会探讨循环展开的好处。（关于分 析和优化前置和计算的内容请参见练习题5. 11、5. 12和家庭作业5. 19。）

​		这样一个过程所需要的时间可以用一个常数加上一个与被处理元素个数成正比的因子来描述。例如，图5-2是这两个函数需要的周期数关于 n 的取值范围图。使用**最小二乘拟合(least squares fit)**

![02前置和函数性能](.\markdowniamge\02前置和函数性能.png)

，我们发现，psum1 和 psum2 的运行时间（用时钟周期为单位）分别近似于等式 368 + 9.0n 和 368 + 6.0n。这两个等式表明对代码计时和初始化过程、准备循环以及完成过程的开销为 368 个周期加上每个元素 6. 0 或 9. 0 周期的线性因子。对于较大的 n 的值（比如说大于200)，运行时间就会主要由线性因子来决定。这些项中的系数称为**每元素的周期数(简称CPE)**的有效值。注意，我们更愿意用每个元素的周期数而不是每次循环的周期数来度量，这是因为像循环展开这样的技术使得我们能够用较少的循环完成计算，而我们最终关心的是，对于给定的向量长度，程序运行的速度如何。我们将精力集中在减小计算的 CPE 上。根据这种度量标准，Psum2 的 CPE 为 6.0 ,优于 CPE 为 9.0  的 psum1。